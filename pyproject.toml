[build-system]
requires = ["setuptools >= 43", "wheel", "setuptools_scm[toml] >= 3.4"]
build-backend = "setuptools.build_meta"

[tool.black]
target-version = ["py37"]

[tool.coverage.run]
omit = [
    "*/setup.py",
    "*/dist/*",
    "*/tests/*",
    "*/.tox/*",
    "*/.eggs/*",
]

[tool.isort]
known_first_party = [
    "Collector",
    "CovReporter",
    "EC2StatusReporter",
    "FTB",
    "Reporter",
    "TaskStatusReporter",
    "covmanager",
    "crashmanager",
    "ec2spotmanager",
    "taskmanager",
]
profile = "black"

[tool.mypy]
strict = true
show_error_codes = true

# Add Python modules to be ignored by mypy here
[[tool.mypy.overrides]]
module = [
    "chartjs.colors",  # Package: django-chartjs
    "chartjs.views.base",  # Package: django-chartjs
    "crispy_forms.helper",  # Package: django-crispy-forms
    "crispy_forms.layout",  # Package: django-crispy-forms
    "enumfields",  # Package: django-enumfields
    "enumfields.fields",  # Package: django-enumfields
    "fasteners",  # Package: fasteners
    "fuzzing_decision.common.pool",  # Package: orion (Mozilla, needs FuzzManager types)
    "laniakea.core.providers.ec2",  # Package: laniakea (Mozilla, currently archived)
    "laniakea.core.providers.gce",  # Package: laniakea (Mozilla, currently archived)
    "laniakea.core.userdata",  # Package: laniakea (Mozilla, currently archived)
    "mozilla_django_oidc.auth",  # Package: mozilla-django-oidc
    "mozillapulse.consumers",  # Package: mozillapulse
    "notifications",  # Package: django-notifications-hq
    "notifications.models",  # Package: django-notifications-hq
    "notifications.signals",  # Package: django-notifications-hq
    "server.covmanager.models",  # Located here in server/covmanager/models.py
    "taskcluster",  # Package: taskcluster
    "S3Manager",  # Located here in misc/afl_libfuzzer/S3Manager.py
]
ignore_missing_imports = true

[tool.pytest.ini_options]
log_level = "DEBUG"
DJANGO_SETTINGS_MODULE = "server.settings_test"
python_paths = [".", "server"]
addopts = ["-v", "--cov=.", "--cov-report", "term-missing"]
filterwarnings = [
    'ignore:"@coroutine" decorator:DeprecationWarning:aiohttp',
    'ignore:You passed a bytestring:DeprecationWarning:flake8.options.config',
    "ignore:Using or importing the ABCs from 'collections':DeprecationWarning:celery.canvas",
    "ignore:Using or importing the ABCs from 'collections':DeprecationWarning:yaml",
]

[tool.setuptools_scm]
